<style>
    .red {
        color: #f00;
        font-size: 16px;
    }

    .comment {
        margin: 15px 0px 0px 50px
    }

    .reply_list {
        margin: 15px auto
    }

    .reply_title {
        display: block;
        padding: 15px;
        border-bottom: 1px solid #ddd
    }
    .reply_cnt {
        padding: 20px
    }

    .reply_button {
        padding: 10px auto
    }

</style>
<form method="post" class="form-horizontal" id="reply_form">
    <div class="form-group">
        <div class="col-sm-10">
            {% if userinfo %}
            <h5 class="red"><span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp; {{ _('Please comment with MarkDown syntax ') }}( {{ _(' at least 10 characters ') }}) </h5>
            {% else %}


            <h5 class="red">
                <span class="glyphicon glyphicon-hand-right"></span>&nbsp;&nbsp;<a href="/user/login" class="btn btn-xs btn-danger" > {{ _('Sign in') }}</a>
                for comments!</h5>
            {% end %}
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-10">
           {% if userinfo %}
            <textarea rows="5" name="cnt_reply" id="cnt_reply" class="form-control"></textarea>
            {% else %}
            <textarea rows="5" name="cnt_reply" id="cnt_reply" class="form-control" readonly></textarea>
            {% end %}
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-10">
            <a id="btn_submit_reply" onclick="reply_it('{{uid}}');" class="btn btn-primary btn-small">
                {{ _('Submit') }}
            </a>
        </div>
    </div>
</form>

<div id="pinglun"></div>
<br>
<p><span class="glyphicon glyphicon-th-list"></span> {{ _(' Comment list') }} (<span  class="red"> {{replys.count()}}</span> )</p>
<p style="border-bottom: 1px dashed #dddddd; margin-bottom: 20px">&nbsp;</p>
{% set ii = 0 %}
{% for reply in replys %}

<div id="del_zan_{{ ii }}" style="font-size: 14px;">
    <div class="reply_list">
        <div class="row">
            <div class="col-sm-2">{% module user_profile_by_id(reply.user_id) %}</div>
            <div class="col-sm-10">
                <div class="reply_title">
                    <span class="red"> <span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;  {{ reply.user_name }}</span>
                    <span class="pull-right"><span class=" glyphicon glyphicon-time"></span>&nbsp;
        {{ str(reply.date).split('.')[0] }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                </div>

                <div class="reply_cnt">
                    <div class="listinfo_content" id="reply_cnt{{ ii }}">
                        {% raw unescape(reply.cnt_html) %}
                    </div>
                    <div class="reply_button pull-right">
                        {% if (userinfo is None) or ( (userinfo) and ( userinfo.uid == reply.user_id )) %}
                        <span class="glyphicon glyphicon-thumbs-up"></span>
                        {% else %}
                        <span class="glyphicon glyphicon-thumbs-up" id="zan_text"
                              onclick="reply_zan('{{ reply.uid }}', {{ ii }} );" style="cursor: pointer"></span>
                        {% end %}
                        <span class="red" id="text_zan_{{ ii }}">{{ reply.vote }}</span>
                        &nbsp;

                        {% if userinfo and userinfo.uid == reply.user_id %}
                        <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModal{{ii}}"><span
                                class="glyphicon glyphicon-pencil"></span>&nbsp;Modify
                        </button>
                        {% end %}
                        {% if userinfo and ( userinfo.uid == reply.user_id or userinfo.role[2] > '1') %}
                        <button class="btn btn-xs btn-primary"
                                onclick="reply_del('{{ reply.uid }}', {{ ii }} );">
                            <span class=" glyphicon glyphicon-trash"></span>
                            {{ _('Delete') }}
                        </button>
                        {% end %}
                        {% if userinfo %}
                        <button class="btn btn-primary btn-xs" data-toggle="collapse" data-target="#demo{{ii}}"><span
                                class="glyphicon glyphicon-share-alt"></span>&nbsp;Reply
                        </button>
                        {% end %}
                    </div>
                </div>
            </div>
        </div>

    </div>
    <br>
        <div id="reply_comment" class="clearfix"></div>
        <div id="demo{{ii}}" class="collapse comment">
                    <form method="post" class="form-horizontal" id="comment_form">
                        <div class="form-group">
                            <div class="col-sm-10">
                               {% if userinfo %}
                                <textarea rows="5" name="cnt_comment{{ii}}" id="cnt_comment{{ii}}" class="form-control"></textarea>
                                {% else %}
                                <textarea rows="5" name="cnt_comment{{ii}}" id="cnt_comment{{ii}}" class="form-control" readonly></textarea>
                                {% end %}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-6">
                                <a id="btn_submit_comment{{ii}}" onclick="comment_it('{{uid}}','{{reply.uid}}','cnt_comment{{ii}}','btn_submit_comment{{ii}}');"
                                   class="btn btn-primary btn-small" data-toggle="collapse" data-target="#demo{{ii}}">
                                    {{ _('Submit') }}
                                </a>
                            </div>
                            <div class="col-sm-6">
                               <button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#demo{{ii}}">Cancel Reply</button>
                            </div>
                        </div>
                    </form>
                </div>
        <ul class="list-group">
            {% module comment_list(replyid = reply.uid,userinfo=userinfo) %}
        </ul>

        <div class="modal fade" id="myModal{{ii}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Modify Comment {{ii}}</h4>
                    </div>
                    <div class="modal-body">
                        <form method="post" class="form-horizontal" id="reply_modify_form">
                            <div class="form-group">
                                <div class="col-sm-10">
                                    <h5 class="red"><span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;
                                        {{ _('Please comment with MarkDown syntax ') }}( {{ _(' at least 10 characters') }})
                                    </h5>

                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-10">
                                <textarea rows="5" name="cnt_modify_reply{{ii}}" id="cnt_modify_reply{{ii}}"
                                          class="form-control">
                                    {% module replycnt(replyid = reply.uid) %}
                                </textarea>
                                </div>
                            </div>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <a onclick="reply_modify('{{reply.uid}}','cnt_modify_reply{{ii}}','0',{{ii}});"
                               data-dismiss="modal" class="btn btn-primary">Submit</a>
                        </form>
                    </div>


                </div>
    </div>
</div>


    <p style="border-bottom: 1px dashed #dddddd; margin-bottom: 20px">&nbsp;</p>
</div>
{% set ii = ii + 1 %}
{% end %}
